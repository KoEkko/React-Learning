
`setState` 是 `Component`的一个方法
this.setState([partialState], [callback]) 

- partialState: 支持部分状态更改
  ```
    this.setState({
      x: 100 // 不论总共有多少状态，我们只修改了x，其余的状态不动
    })
  ```

- callback：在状态更改、视图更新完毕后触发执行（也可以说只要执行了setState，callback一定会执行，不需要状态和视图更新才会触发callback函数）
  - 发生在`componentDidUpdate`周期函数之后（DidUpdate会在任何状态更改后触发执行，而回调函数方式，可以在指定状态更新后处理一些事情）
  - 特殊：即便我们基于`shouldComponentUpdate`阻止了状态、视图的更新，DidUpdate周期函数肯定不会执行了，但是我们设置的这个callback回调函数依然会被触发执行！）


在React18中，setState在任何地方执行（例如：合成事件、周期函数、定时器...），都是异步操作

- React18中有一套更新队列（updater）的机制
  - 在当前相同的时间段内（浏览器此时可以处理的事情中「跟浏览器的同步异步机制又不太相同，如果同时设置三个定时器，此时三个更新依旧是同一个更新队列的，如果跟浏览器的机制是相同的话，则是执行三次更新操作了」），遇到setState会立即放入到更新队列中！
  - 此时状态、视图还没更新
  - 当所有的代码操作结束，会刷新队列（通知更新队列中的任务执行
- 基于异步操作，实现状态的批处理
- 好处： 

  - 减少视图更新的次数，降低渲染消耗的性能
  - 让更新的逻辑和流程更加清晰和稳健

函数在执行的时候会产生私有上下文，代码自上而下执行
1. 会把所有的setState操作，先加入到更新队列，只对当前上下文，同步要做的事情做处理
2. 当上下文中的代码都处理完毕后，会让更新队列中的任务，统一渲染、更新一次